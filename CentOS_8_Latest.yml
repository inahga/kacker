sensitive-variables:
- "vsphere-password"

variables:
  kickstart: "{{env `KICKSTART`}}"
  server: "vcsa0.vsphere.inahga.org"
  vm_name: "Packer_CentOS_8_Latest"
  host: "esxi2.vsphere.inahga.org"
  datastore: "esxi2-Local"
  CPUs: "2"
  RAM: "2048"
  disk_size: "16384"

builders:
- type: "vsphere-iso"
  convert_to_template: "true"
  vcenter_server: "{{user `server`}}"
  username: "{{user `vsphere-user`}}"
  password: "{{user `vsphere-password`}}"
  insecure_connection: "true"

  vm_name: "{{user `vm_name`}}"
  folder: "PackerTemplates"
  host: "{{user `host`}}"
  datastore: "{{user `datastore`}}"
  network: "DPG-10-Public"

  notes: "Built by Packer, created by {{user `vsphere-user`}} on {{isotime}}"
  guest_os_type: "centos8_64guest"

  ssh_username: "root"
  ssh_password: "password"

  CPUs: "{{user `CPUs`}}"
  RAM: "{{user `RAM`}}"
  disk_size: "{{user `disk_size`}}"
  disk_thin_provisioned: "true"
  disk_controller_type: "pvscsi"
  network_card: "vmxnet3"

  iso_urls: "http://bay.uchicago.edu/centos/8.2.2004/isos/x86_64/CentOS-8.2.2004-x86_64-boot.iso"
  iso_checksum: "c67876a5602faa17f68b40ccf2628799b87454aa67700f0f57eec15c6ccdd98c"

  http_directory: "./"

  boot_command:
  - "<esc><wait>"
  - "linux ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/{{user `kickstart`}}<enter>"

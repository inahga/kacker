sensitive-variables:
  - "vsphere-password"

variables:
  kickstart: "CentOS_8_BackupRepo_ks.cfg"
  server: "vcsa0.vsphere.inahga.org"
  vm_name: "Packer_CentOS_8_BackupRepo"
  host: "esxi2.vsphere.inahga.org"
  datastore: "esxi2-Local"
  CPUs: "2"
  RAM: "2048"
  disk1_size: "16384"
  disk2_size: "1048576"

builders:
  - type: "vsphere-iso"
    convert_to_template: "true"
    vcenter_server: "{{user `server`}}"
    username: "{{user `vsphere-user`}}"
    password: "{{user `vsphere-password`}}"
    insecure_connection: "true"

    vm_name: "{{user `vm_name`}}"
    folder: "PackerTemplates"
    host: "{{user `host`}}"
    datastore: "{{user `datastore`}}"
    network: "DPG-10-Public"

    notes: "Built by Packer, created by {{user `vsphere-user`}} on {{isotime}}"
    guest_os_type: "centos8_64guest"

    ssh_username: "root"
    ssh_password: "password"

    CPUs: "{{user `CPUs`}}"
    RAM: "{{user `RAM`}}"

    storage:
      - disk_size: "{{user `disk1_size`}}"
        disk_thin_provisioned: "true"
      - disk_size: "{{user `disk2_size`}}"
        disk_thin_provisioned: "true"
    disk_controller_type: "pvscsi"

    network_card: "vmxnet3"

    iso_urls: "http://bay.uchicago.edu/centos/8.1.1911/isos/x86_64/CentOS-8.1.1911-x86_64-boot.iso"
    iso_checksum: "7fea13202bf2f26989df4175aace8fdc16e1137f7961c33512cbfad844008948"

    http_directory: "http"
    
    boot_command:
      - "<esc><wait>"
      - "linux ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/{{user `kickstart`}}<enter>"
